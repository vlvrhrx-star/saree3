<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سريع Max | مشاهدة وتحميل</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@500;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            background: #111; color: white; font-family: 'Tajawal', sans-serif;
            display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0;
        }
        .app-box {
            width: 100%; max-width: 500px; text-align: center;
        }
        h1 { margin-bottom: 20px; background: linear-gradient(45deg, #FF3CAC, #784BA0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .input-group {
            background: #222; padding: 5px; border-radius: 50px; display: flex;
            border: 1px solid #444; margin-bottom: 20px;
        }
        input {
            flex: 1; background: transparent; border: none; color: white; padding: 15px;
            font-size: 1rem; text-align: center; outline: none;
        }
        button {
            background: white; color: black; border: none; padding: 0 25px;
            border-radius: 50px; font-weight: bold; cursor: pointer;
        }

        /* منطقة الفيديو */
        .video-wrapper {
            display: none; background: #222; padding: 15px; border-radius: 20px;
            border: 1px solid #333; animation: fadeIn 0.5s;
        }
        video {
            width: 100%; border-radius: 15px; margin-bottom: 15px; background: black;
        }
        .btn-save {
            display: block; background: #00b894; color: white; text-decoration: none;
            padding: 15px; border-radius: 12px; font-weight: bold; font-size: 1.1rem;
        }
        .btn-save:hover { opacity: 0.9; }

        .loader { display: none; color: #784BA0; font-size: 2rem; margin-top: 20px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="app-box">
        <h1>سريع Max <i class="fas fa-bolt"></i></h1>

        <div class="input-group">
            <input type="text" id="url" placeholder="الصق رابط الفيديو هنا...">
            <button onclick="fetchVideo()">جلب</button>
        </div>

        <div class="loader" id="loader"><i class="fas fa-circle-notch fa-spin"></i></div>

        <div class="video-wrapper" id="playerBox">
            <video id="myVideo" controls playsinline></video>
            <a id="dlBtn" href="#" target="_blank" class="btn-save">
                <i class="fas fa-download"></i> اضغط هنا للحفظ
            </a>
        </div>
        
        <p id="errMsg" style="color:#ff7675; display:none; margin-top:15px;">خطأ: تأكد أن الرابط صحيح وعام.</p>
    </div>

    <script>
        async function fetchVideo() {
            const url = document.getElementById('url').value.trim();
            const loader = document.getElementById('loader');
            const playerBox = document.getElementById('playerBox');
            const vidPlayer = document.getElementById('myVideo');
            const dlBtn = document.getElementById('dlBtn');
            const errMsg = document.getElementById('errMsg');

            if(!url) return;

            // إعادة تعيين
            loader.style.display = 'block';
            playerBox.style.display = 'none';
            errMsg.style.display = 'none';

            try {
                // استخدام API بسيط جداً ومباشر
                let apiUrl = "";
                
                // تيك توك
                if(url.includes('tiktok.com')) {
                   const res = await fetch(`https://www.tikwm.com/api/?url=${url}`);
                   const data = await res.json();
                   if(data.code === 0) {
                       showPlayer(data.data.play);
                   } else { throw new Error(); }
                } 
                // باقي المواقع (محرك Cobalt)
                else {
                    const res = await fetch('https://api.cobalt.tools/api/json', {
                        method: 'POST',
                        headers: { 'Accept': 'application/json', 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url: url })
                    });
                    const data = await res.json();
                    if(data.url) showPlayer(data.url);
                    else if(data.picker) showPlayer(data.picker[0].url);
                    else throw new Error();
                }

            } catch (e) {
                loader.style.display = 'none';
                errMsg.style.display = 'block';
            }
        }

        function showPlayer(videoUrl) {
            document.getElementById('loader').style.display = 'none';
            
            const playerBox = document.getElementById('playerBox');
            const vidPlayer = document.getElementById('myVideo');
            const dlBtn = document.getElementById('dlBtn');

            // إعداد المشغل
            vidPlayer.src = videoUrl;
            
            // إعداد زر التحميل
            dlBtn.href = videoUrl;
            
            playerBox.style.display = 'block';
        }
    </script>
</body>
</html>
